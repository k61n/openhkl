variables:
  DEBIAN_FRONTEND: noninteractive

stages:
- build

build:ubuntu:
  stage: build
  image: ubuntu:22.04
  before_script:
    - apt-get update
    - apt-get install -y
        build-essential
        cmake
        libblosc-dev
        libeigen3-dev
        libfftw3-dev
        libgl-dev
        libgsl-dev
        libhdf5-dev
        libopencv-dev
        libpython3-dev
        libqhull-dev
        libtiff-dev
        libyaml-cpp-dev
        python3
        python3-numpy
        qt5-qmake
        qtbase5-dev
        qtbase5-dev-tools
        qtchooser
        swig
  script:
    - mkdir build
    - cd build
    - cmake ..
    - make -j8
    - ctest -j8
  # artifacts:
  #   paths:
  #   - src/libmandel.so
  #   expire_in: 1 day

pages:
  stage: deploy:doc
  script:
    - apt-get install -y python3-pip doxygen graphviz
    - python3 -m pip install -U pip
    - python3 -m pip install
        sphinx
        sphinxcontrib-bibtex
        sphinx-press-theme
        breathe
    - cd build
    - cmake ..
    - make docs
    - mv doc/sphinx/html public/
    - mv doc/sphinx/_static public/
  artifacts:
    paths:
      - public
    only:
      - pages
