%--------------------------------------------------------------------------------------------------
\documentclass[twocolumn,preprintnumbers,amsmath,amssymb]{revtex4}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{url}
\usepackage{amsmath}
\usepackage[nottoc,numbib]{tocbibind}


% convenience commands
\newcommand{\CChalf}{CC_{1/2}}
\newcommand{\CCtrue}{CC_{\mathrm{true}}}
\newcommand{\CCstar}{CC\ast}
\newcommand{\cov}{\mathrm{cov}}
\newcommand{\E}{\mathrm{E}}
\newcommand{\nsxtool}{{\tt{nsxtool}}}

\newcommand{\calP}{\mathcal{P}}
\newcommand{\calB}{\mathcal{B}}

\def\v#1{\mathbf{#1}}

% for placeholder text
% \usepackage{lipsum}

%--------------------------------------------------------------------------------------------------

\begin{document}

\title{NSXTool Internal Documentation: Notes on Literature}
\author{the NSXTool collaboration}

\date{internal notes, work in progress, do not circulate, \today}


\maketitle

\section{Kabsch 2010b}

Paper on ``Integration, scaling, space-group assignement and post-refinement'' \cite{Kab10b}.

\subsection{Notation correspondences}
%--------------------------------------------------------------------------------------------------

\begin{tabular}{lll}
&Kabsch &we\\\hline
incident wavevector &$\v{S}_0$ &$\v{k}_\text{i}$\\
reciprocal vector &$\v{p^*}$ &?\\
detector distance &$F$ &?\\
\end{tabular}

\subsection{Spot prediction (Sect 2.2)}
%--------------------------------------------------------------------------------------------------

This section uses vector components in the coordinate system $\{\v{m}_1,\v{m}_2,\v{m}_3\}$.
In this special system,
$\v{p}^*$ and $\v{p}^*_0$ are related to each other
through a rotation by $\varphi$ around $v{m}_2$,
and $\v{S}_0$ is perpendicular to $\v{m}_1$.

\subsubsection{How to obtain $\v{p}^*$ as function of $\v{p}^*_0,\varphi$}

In $\v{p}^*=D(\v{m}_2,\varphi)\v{p}^*_0$, just insert the standard rotation matrix~$D$.
Skip the line that involves the cross-product $\v{m}_2\times\v{p}^*_0$,
and directly obtain the next line.

\subsubsection{How to obtain $\v{p}^*$ as function of $\v{p}^*_0,\v{S}_0$}

First, the component along $\v{m}_2$: Rotation around $\v{m}_2$ does not change this component,
hence $\v{p}^*\v{m}_2 = \v{p}^*_0\v{m}_2$.

Next, the component along $\v{m}_3$:
By construction, $\v{m}_1\perp\v{S}_0$.
This simplifies the vector product
\begin{equation}
\begin{array}{ll}
   \v{S}_0\v{p}^*&=(\v{S_0}\v{m}_2)(\v{m}_2\v{p}^*) + (\v{S_0}\v{m}_3)(\v{m}_3\v{p}^*)
\\
                &=(\v{S_0}\v{m}_2)(\v{m}_2\v{p}^*_0) + (\v{S_0}\v{m}_3)(\v{m}_3\v{p}^*).
\end{array}
\end{equation}
Insert this in the Laue equation $-2\v{S}_0\v{p}^*={p^*_0}^2$,
and resolve for $\v{p}^*\v{m}_3$.

Finally, the component along $\v{m}_1$:
Resolve ${p^*_0}^2=\sum {(\v{p}^*\v{m}_i)}^2$ for $\v{p}^*\v{m}_1$.

\subsubsection{How to obtain $\varphi$ as function of $\v{p}^*_0,\v{p}^*$}

Start from
\begin{equation}
  \cos\varphi=\frac{{\v{p}^*}_\perp{\v{p}^*_0}_\perp}{|{\v{p}^*}_\perp|\;|{\v{p}^*_0}_\perp|},
\end{equation}
where the subscript~$\perp$ designates the projection into the plane
perpendicular to $\v{m_2}$.

\subsection{Standard spot size (Sect 2.3)}
%--------------------------------------------------------------------------------------------------

\subsubsection{Increase in path length}

Kabsch introduces a factor $1/|\v{e}_1\v{m}_2|$ as
\textit{an increase in the length of the shortest path},
viz.\ of a rotated reciprocal space vector $\v{p}^*_\varphi$ across the Ewald sphere.

To explain this notion,
replace the Ewald sphere by its tangential plane,
and approximate the trajectory $\v{p}^*_\varphi$ by a straight line.
Suppose this line forms an angle $\alpha$ with the normal of the plane.
Then ask: how long is the line segment that brings us from the intersection
with the plane to a distance $\Delta x$ from the plane.
Answer: $\Delta x/\cos\alpha$.
So $1/\cos\alpha$ is the factor by which the shortest path increases.

The trajectory $\v{p}^*_\varphi=D(\v{m}_2,\varphi)\v{p}^*_0$
has the tangent vector
$\mathrm{d}\v{p}^*_\varphi/\mathrm{d}\varphi=\v{\hat p}^*_\varphi\times\v{\hat m}_2$.
When it intersects the Ewald sphere,
we may equate $\v{p}^*_\varphi=\v{q}\equiv\v{k}_\text{f}-\v{k}_\text{i}$.
The normal vector of the Ewald sphere is $\v{\hat k}_\text{f}$.
So
\begin{equation}
  \cos\alpha = \frac{(\v{q}\times\v{m_2})\v{k}_\text{f}}{|\v{q}\times\v{m_2}| k}
\end{equation}
The numerator can be transformed as
$(\v{q}\times\v{m_2})\v{k}_\text{f}
=(\v{k}_\text{f}\times\v{q})\v{m_2}
=(\v{k}_\text{f}\times(\v{k}_\text{f}-\v{k}_\text{i}))\v{m_2}
=(\v{k}_\text{f}\times(-\v{k}_\text{i}))\v{m_2}
=(\v{k}_\text{i}\times\v{k}_\text{f})\v{m_2}$.
So we have
\begin{equation}
  \cos\alpha = \frac{(\v{k}_\text{i}\times\v{k}_\text{f})\v{m_2}}{|\v{q}\times\v{m_2}| k},
\end{equation}
which agrees with Kabsch's
\begin{equation}
  |\v{e}_1\v{m}_2|
  =\left|\frac{(\v{k}_\text{i}\times\v{k}_\text{f})\v{m_2}}{|\v{k}_\text{f}\times\v{k}_\text{i}|}\right|
\end{equation}
in the numerator, but not in the denominator.


\subsubsection{Lorentz correction factor}

``Another geometric correction that accounts for the length of time that a moving crystal remains in the diffracting position for any particular scattered beam. Since different reciprocal lattice points correspond to different sets of diffracting planes with different geometries relative to the instrument, the Lorentz factor depends both on the Bragg angle and on the diffraction geometry.''
[Online Dictionary of Crystallography,
\url{http://reference.iucr.org/dictionary/Lorentz-polarization_correction}]
See also \cite{Bue40}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{switch}
\bibliography{jw7}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
