set(DOXYGEN_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/doxygen/)
set(DOXYGEN_OUTPUT_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/doxygen/)
set(DOXYGEN_XML_DIR ${DOXYGEN_OUTPUT_DIRECTORY}/xml)

configure_file(${DOXYGEN_SOURCE_DIR}/Doxyfile ${DOXYGEN_OUTPUT_DIRECTORY}/Doxyfile)

set(SPHINX_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/sphinx/)
set(SPHINX_BUILD_DIR ${CMAKE_CURRENT_BINARY_DIR}/sphinx/)
set(SPHINX_BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR}/_binary/)
set(SPHINX_CACHE_DIR ${CMAKE_CURRENT_BINARY_DIR}/sphinx/_doctrees/)
set(SPHINX_HTML_DIR ${CMAKE_CURRENT_BINARY_DIR}/sphinx/html/)
set(SPHINX_LATEX_DIR ${CMAKE_CURRENT_BINARY_DIR}/sphinx/latex/)

configure_file(${SPHINX_SOURCE_DIR}/conf.py ${SPHINX_BUILD_DIR}/conf.py @ONLY)
file(COPY ${SPHINX_SOURCE_DIR}/_static DESTINATION ${SPHINX_BUILD_DIR})

set(SPHINX_COMMAND "${SPHINX_EXECUTABLE} -q -b html
  -d ${SPHINX_CACHE_DIR} ${SPHINX_SOURCE_DIR} ${SPHINX_HTML_DIR}")

add_custom_target(
  docs
  COMMAND doxygen ${DOXYGEN_OUTPUT_DIRECTORY}/Doxyfile
  COMMAND ${SPHINX_EXECUTABLE}
    -q -b html
    -c "${SPHINX_SOURCE_DIR}"
    -d "${SPHINX_CACHE_DIR}"
    "${SPHINX_SOURCE_DIR}"
    "${SPHINX_HTML_DIR}"
  COMMENT "Building HTML documentation with Doxygen and Sphinx")

add_custom_target(
  pdf
  COMMAND ${SPHINX_EXECUTABLE}
    -b latex
    -c "${SPHINX_SOURCE_DIR}"
    -d "${SPHINX_CACHE_DIR}"
    "${SPHINX_SOURCE_DIR}"
    "${SPHINX_LATEX_DIR}"
  COMMENT "Compile ${SPHINX_LATEX_DIR}/openhkl.tex using pdflatex")
